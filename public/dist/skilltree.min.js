!function(n,t){function i(n){for(var t=n.split("."),i=window,e="",o=0,r=t.length;r>o;o++)e=t[o],i[e]=i[e]||{},i=i[e];return i}function e(n){return n.length>2&&(n=[n.slice(0,n.length-1).join(", "),n[n.length-1]]),n.join(" and ")}t.bindingHandlers.rightClick={init:function(t,i){n(t).on("mousedown",function(n){3==n.which&&i()()}).on("contextmenu",function(n){n.preventDefault()})}},function(n){n.Calculator=function(n){function e(n){return t.utils.arrayFirst(u.skills(),function(t){return t.id==n})}function o(n){if(n){v=!1,u.newbMode();var i=n.split(l);i[2]&&u.portrait(Number(i[2])),i[3]&&u.avatarName(i[3]);for(var o=i[1],r=[],a=o.split(""),s=0;s<a.length;s++)if(!Number(a[s])){var p=e(a[s].charCodeAt(0)-c);if(p){var d=Number(a[s+1])||1;r.push({skill:p,points:d})}}for(var f=!0;f;)f=!1,t.utils.arrayForEach(r,function(n){!n.wasAllocated&&n.skill.canAddPoints()&&(n.skill.points(Math.min(n.skill.maxPoints,n.points)),n.wasAllocated=!0,f=!0)});v=!0}}function r(){o(d)}function a(n){window.location.hash=n||h}var s=n||{},u=function(){},c=96,l="_",p=s.numPortraits||1;u.isOpen=t.observable(!0),u.open=function(){u.isOpen(!0)},u.close=function(){u.isOpen(!1)},u.toggle=function(){u.isOpen(!u.isOpen())},u.skills=t.observableArray(t.utils.arrayMap(s.skills,function(n){return new i(n,u.skills,s.learnTemplate)})),t.utils.arrayForEach(s.skills,function(n){if(n.dependsOn){var i=e(n.id);t.utils.arrayForEach(n.dependsOn,function(n){var t=e(n);i.dependencies.push(t),t.dependents.push(i)})}}),u.avatarName=t.observable("Your Name"),u.level=t.computed(function(){var n=0;return t.utils.arrayForEach(u.skills(),function(t){n+=t.points()}),n+1}),u.noPointsSpent=t.computed(function(){return!Boolean(t.utils.arrayFirst(u.skills(),function(n){return n.points()>0}))}),u.stats=t.computed(function(){var n=s.defaultStats||{};t.utils.arrayForEach(u.skills(),function(i){var e=i.points();e>0&&t.utils.arrayForEach(i.stats,function(t){var i=n[t.title]||0;i+=t.value*e,n[t.title]=i})});var i=[];for(var e in n)i.push({title:e,value:n[e]});return i}),u.talentSummary=t.computed(function(){var n=[];return t.utils.arrayForEach(u.skills(),function(t){t.hasPoints()&&(n=n.concat(t.talents))}),n.join(", ")}),u.portrait=t.observable(Math.ceil(Math.random()*p)),u.portraitURL=t.computed(function(){return(s.portraitPathTemplate||"img/portraits/portrait-{n}.jpg").replace("{n}",u.portrait())}),u.choosePreviousPortrait=function(){var n=u.portrait()-1;1>n&&(n=p),u.portrait(n)},u.chooseNextPortrait=function(){var n=u.portrait()+1;n>p&&(n=1),u.portrait(n)},u.newbMode=function(){t.utils.arrayForEach(u.skills(),function(n){n.points(0)})},u.godMode=function(){t.utils.arrayForEach(u.skills(),function(n){n.points(n.maxPoints)})},u.hash=t.computed(function(){var n=[];return t.utils.arrayForEach(u.skills(),function(t){t.hasPoints()&&(n.push(String.fromCharCode(t.id+c)),t.hasMultiplePoints()&&n.push(t.points()))}),["",n.join(""),u.portrait(),u.avatarName()].join(l)});var d,f,h,m,v=!0;u.useHash=function(n){d=n,clearTimeout(f),f=setTimeout(r,50)},u.hash.subscribe(function(n){v&&(h=n,clearTimeout(m),m=setTimeout(a,50))}),window.onhashchange=function(){u.useHash(window.location.hash.substr(1))};var k=window.location.hash.substr(1);return u.isOpen(""!=k),u.useHash(k),u};var i=n.Skill=function(n,i,r){var a=n||{},s=function(){};return s.id=a.id||0,s.title=a.title||"Unknown Skill",s.description=a.description,s.maxPoints=a.maxPoints||1,s.points=t.observable(a.points||0),s.links=t.utils.arrayMap(a.links,function(n){return new o(n)}),s.dependencies=t.observableArray([]),s.dependents=t.observableArray([]),s.stats=a.stats||[],s.rankDescriptions=a.rankDescriptions||[],s.talents=a.talents||[],s.hasDependencies=t.computed(function(){return s.dependencies().length>0}),s.dependenciesFulfilled=t.computed(function(){var n=!0;return t.utils.arrayForEach(s.dependencies(),function(t){t.hasPoints()||(n=!1)}),n}),s.dependentsUsed=t.computed(function(){var n=!1;return t.utils.arrayForEach(s.dependents(),function(t){t.hasPoints()&&(n=!0)}),n}),s.hasPoints=t.computed(function(){return s.points()>0}),s.hasMultiplePoints=t.computed(function(){return s.points()>1}),s.hasMaxPoints=t.computed(function(){return s.points()>=s.maxPoints}),s.canAddPoints=t.computed(function(){return s.dependenciesFulfilled()&&!s.hasMaxPoints()}),s.canRemovePoints=t.computed(function(){return s.dependentsUsed()&&s.hasMultiplePoints()||!s.dependentsUsed()&&s.hasPoints()}),s.helpMessage=t.computed(function(){if(!s.dependenciesFulfilled()){var n=[];return t.utils.arrayForEach(s.dependencies(),function(t){t.hasMaxPoints()||n.push(t.title)}),(r||"Learn {n} to unlock.").replace("{n}",e(n))}return""}),s.talentSummary=t.computed(function(){return s.talents.join(", ")}),s.currentRankDescription=t.computed(function(){return s.rankDescriptions[s.points()-1]}),s.nextRankDescription=t.computed(function(){return s.rankDescriptions[s.points()]}),s.addPoint=function(){s.canAddPoints()&&s.points(s.points()+1)},s.removePoint=function(){s.canRemovePoints()&&s.points(s.points()-1)},s},o=n.Link=function(n){var t=n||{},i=function(){};return i.label=t.label||t.url||"Learn more",i.url=t.url||"javascript:void(0)",i}}(i("tft.skilltree"))}(window.jQuery,window.ko);